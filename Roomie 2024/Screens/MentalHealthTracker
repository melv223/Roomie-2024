//
//  ViewController.swift
//  MentalHealthTracker
//
//  Created by Corinne Simeone
//

import SwiftUI
struct MentalHealthTrackerForm: View{
    @State private var scoreText: String = ""
    @State private var showingAlert: Bool = false
    @State private var alertTitle: String = ""
    @State private var alertMessage: String = ""
    @FocusState private var focusedField: FormField?
    
    enum FormField{
        case score
    }
    var body: some View{
        NavigationStack{
            Form{
                Section(header: Text("Mental Health Score")){
                    TextField("Enter a score from 1 to 10", text: $scoreText)
                        .padding(10)
                        .background(Color(.systemGray6))
                        .cornerRadius(10)
                        .keyboardType(.numberPad)
                        .submitLabel(.done)
                        .focused($focusedField, equals: .score)
                        .onSubmit{
                            validateScore()
                        }
                }
                //submit button
                Button(action: {
                    validateScore()
                },
                       label:{
                    Text("Submit Score").frame(minWidth: .infinity)
                })
                .buttonStyle(.borderedProminent).tint(Color.green)
            }
            
            .navigationBarTitle("Mental Health Tracker")
            .scrollContentBackground(.hidden)
            .background(Color.gray)
            .alert(isPresented: $showingAlert){ Alert(title: Text("Mental health Tracker"), message: Text(alertMessage), dismissButton: .default(Text("OK")))
            }
        }
        
        .onAppear{
            focusedField = .score
        }
    }
    //score input and show alert
    private func validateScore(){
        guard let score = Int(scoreText), score >= 1, score <= 10 else {
            alertMessage = "Please enter a number between 1 - 10"
            showingAlert = true
            return
        }
        let concernFlag = score < 3
        alertMessage = concernFlag
        ? "Your mental health score is \(score). You may want to talk to a counselor."
        : "Your mental health score is \(score). You are doing great!"
        //log
        let entry:[String:Any] = [
            "email": "student@manhattan.edu",
            "date": Date(),
            "score": score,
            "concernFlag": concernFlag
        ]
        print("Entry Recorded: \(entry)")
        showingAlert = true
    }
}
#Preview {
    MentalHealthTrackerForm()
}

